<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Two scoops of django | Today Yurim Learned</title>
    <meta name="description" content="Yurim&#39;s Personal Wiki (Today I Learned)">
    <link rel="icon" href="/TIL/logo.png">
    
    <link rel="preload" href="/TIL/assets/css/226.styles.c95da30a.css" as="style"><link rel="preload" href="/TIL/assets/js/app.4577e9c5.js" as="script"><link rel="preload" href="/TIL/assets/js/156.3e99d878.js" as="script"><link rel="prefetch" href="/TIL/assets/js/99.b233d1f6.js"><link rel="prefetch" href="/TIL/assets/js/0.09100298.js"><link rel="prefetch" href="/TIL/assets/js/1.b69d9ba2.js"><link rel="prefetch" href="/TIL/assets/js/2.d05ae538.js"><link rel="prefetch" href="/TIL/assets/js/3.c3465243.js"><link rel="prefetch" href="/TIL/assets/js/4.edba8ced.js"><link rel="prefetch" href="/TIL/assets/js/5.b44ac560.js"><link rel="prefetch" href="/TIL/assets/js/6.1dd4fda3.js"><link rel="prefetch" href="/TIL/assets/js/7.77a15ece.js"><link rel="prefetch" href="/TIL/assets/js/8.240c7ce9.js"><link rel="prefetch" href="/TIL/assets/js/9.cb1991a4.js"><link rel="prefetch" href="/TIL/assets/js/10.61e64950.js"><link rel="prefetch" href="/TIL/assets/js/11.8628fe93.js"><link rel="prefetch" href="/TIL/assets/js/12.ee7d0636.js"><link rel="prefetch" href="/TIL/assets/js/13.a7cfd9cd.js"><link rel="prefetch" href="/TIL/assets/js/14.229c47c1.js"><link rel="prefetch" href="/TIL/assets/js/15.5749b4dc.js"><link rel="prefetch" href="/TIL/assets/js/16.cd178dd5.js"><link rel="prefetch" href="/TIL/assets/js/17.03acce12.js"><link rel="prefetch" href="/TIL/assets/js/18.d23fb0a3.js"><link rel="prefetch" href="/TIL/assets/js/19.554d167a.js"><link rel="prefetch" href="/TIL/assets/js/20.b88c61f9.js"><link rel="prefetch" href="/TIL/assets/js/21.fff1fbbd.js"><link rel="prefetch" href="/TIL/assets/js/22.02ba33bc.js"><link rel="prefetch" href="/TIL/assets/js/23.11dc8809.js"><link rel="prefetch" href="/TIL/assets/js/24.87cd09e0.js"><link rel="prefetch" href="/TIL/assets/js/25.fb7a2acd.js"><link rel="prefetch" href="/TIL/assets/js/26.aa8a59e5.js"><link rel="prefetch" href="/TIL/assets/js/27.69d1b96e.js"><link rel="prefetch" href="/TIL/assets/js/28.e2b14c7c.js"><link rel="prefetch" href="/TIL/assets/js/29.0018ced3.js"><link rel="prefetch" href="/TIL/assets/js/30.82c7eb7a.js"><link rel="prefetch" href="/TIL/assets/js/31.4ae2c598.js"><link rel="prefetch" href="/TIL/assets/js/32.3caab529.js"><link rel="prefetch" href="/TIL/assets/js/33.944a33cc.js"><link rel="prefetch" href="/TIL/assets/js/34.70180c27.js"><link rel="prefetch" href="/TIL/assets/js/35.8be28998.js"><link rel="prefetch" href="/TIL/assets/js/36.de7f67eb.js"><link rel="prefetch" href="/TIL/assets/js/37.baa1c985.js"><link rel="prefetch" href="/TIL/assets/js/38.cafd6d95.js"><link rel="prefetch" href="/TIL/assets/js/39.343f3cca.js"><link rel="prefetch" href="/TIL/assets/js/40.e5150807.js"><link rel="prefetch" href="/TIL/assets/js/41.d4757e3b.js"><link rel="prefetch" href="/TIL/assets/js/42.e89eabca.js"><link rel="prefetch" href="/TIL/assets/js/43.09e5f652.js"><link rel="prefetch" href="/TIL/assets/js/44.66773978.js"><link rel="prefetch" href="/TIL/assets/js/45.998788d6.js"><link rel="prefetch" href="/TIL/assets/js/46.ebdd89de.js"><link rel="prefetch" href="/TIL/assets/js/47.3e1a3107.js"><link rel="prefetch" href="/TIL/assets/js/48.2ee8171f.js"><link rel="prefetch" href="/TIL/assets/js/49.cfa97ad9.js"><link rel="prefetch" href="/TIL/assets/js/50.0c2cc407.js"><link rel="prefetch" href="/TIL/assets/js/51.15106bca.js"><link rel="prefetch" href="/TIL/assets/js/52.ca434002.js"><link rel="prefetch" href="/TIL/assets/js/53.8b87261f.js"><link rel="prefetch" href="/TIL/assets/js/54.4ef09e38.js"><link rel="prefetch" href="/TIL/assets/js/55.edabb32e.js"><link rel="prefetch" href="/TIL/assets/js/56.db4c2192.js"><link rel="prefetch" href="/TIL/assets/js/57.f8d7d29c.js"><link rel="prefetch" href="/TIL/assets/js/58.49590588.js"><link rel="prefetch" href="/TIL/assets/js/59.54911455.js"><link rel="prefetch" href="/TIL/assets/js/60.f6519916.js"><link rel="prefetch" href="/TIL/assets/js/61.38347a11.js"><link rel="prefetch" href="/TIL/assets/js/62.ef03785d.js"><link rel="prefetch" href="/TIL/assets/js/63.1e5ec898.js"><link rel="prefetch" href="/TIL/assets/js/64.a6956a26.js"><link rel="prefetch" href="/TIL/assets/js/65.eff45187.js"><link rel="prefetch" href="/TIL/assets/js/66.fec8f3c6.js"><link rel="prefetch" href="/TIL/assets/js/67.e36abb92.js"><link rel="prefetch" href="/TIL/assets/js/68.09f1eedc.js"><link rel="prefetch" href="/TIL/assets/js/69.d117ee7b.js"><link rel="prefetch" href="/TIL/assets/js/70.dc3ead48.js"><link rel="prefetch" href="/TIL/assets/js/71.afa79aeb.js"><link rel="prefetch" href="/TIL/assets/js/72.b3522fd0.js"><link rel="prefetch" href="/TIL/assets/js/73.0ab23319.js"><link rel="prefetch" href="/TIL/assets/js/74.bc8dacec.js"><link rel="prefetch" href="/TIL/assets/js/75.2764bc79.js"><link rel="prefetch" href="/TIL/assets/js/76.5d4da410.js"><link rel="prefetch" href="/TIL/assets/js/77.04490b31.js"><link rel="prefetch" href="/TIL/assets/js/78.48ca6bba.js"><link rel="prefetch" href="/TIL/assets/js/79.9dda3908.js"><link rel="prefetch" href="/TIL/assets/js/80.53f26122.js"><link rel="prefetch" href="/TIL/assets/js/81.d2ffe076.js"><link rel="prefetch" href="/TIL/assets/js/82.356107cf.js"><link rel="prefetch" href="/TIL/assets/js/83.b6225f73.js"><link rel="prefetch" href="/TIL/assets/js/84.ed81ea96.js"><link rel="prefetch" href="/TIL/assets/js/85.348f350e.js"><link rel="prefetch" href="/TIL/assets/js/86.6cd7e5e3.js"><link rel="prefetch" href="/TIL/assets/js/87.180ce2e1.js"><link rel="prefetch" href="/TIL/assets/js/88.88b26d5a.js"><link rel="prefetch" href="/TIL/assets/js/89.2031c91c.js"><link rel="prefetch" href="/TIL/assets/js/90.7f99b454.js"><link rel="prefetch" href="/TIL/assets/js/91.001e4d99.js"><link rel="prefetch" href="/TIL/assets/js/92.724defd2.js"><link rel="prefetch" href="/TIL/assets/js/93.3029105f.js"><link rel="prefetch" href="/TIL/assets/js/94.e34249fd.js"><link rel="prefetch" href="/TIL/assets/js/95.1620828b.js"><link rel="prefetch" href="/TIL/assets/js/96.ac6edf50.js"><link rel="prefetch" href="/TIL/assets/js/97.137eae53.js"><link rel="prefetch" href="/TIL/assets/js/98.bdd591f2.js"><link rel="prefetch" href="/TIL/assets/js/100.df934624.js"><link rel="prefetch" href="/TIL/assets/js/101.51dbacb2.js"><link rel="prefetch" href="/TIL/assets/js/102.809d4f30.js"><link rel="prefetch" href="/TIL/assets/js/103.3e251edc.js"><link rel="prefetch" href="/TIL/assets/js/104.d28d8ac4.js"><link rel="prefetch" href="/TIL/assets/js/105.2bdbcd67.js"><link rel="prefetch" href="/TIL/assets/js/106.26046491.js"><link rel="prefetch" href="/TIL/assets/js/107.ab82cf5b.js"><link rel="prefetch" href="/TIL/assets/js/108.74836243.js"><link rel="prefetch" href="/TIL/assets/js/109.08009a65.js"><link rel="prefetch" href="/TIL/assets/js/110.76d294ad.js"><link rel="prefetch" href="/TIL/assets/js/111.3fa7e5e5.js"><link rel="prefetch" href="/TIL/assets/js/112.a3e8db8b.js"><link rel="prefetch" href="/TIL/assets/js/113.440f4ffd.js"><link rel="prefetch" href="/TIL/assets/js/114.4bf022c4.js"><link rel="prefetch" href="/TIL/assets/js/115.0154a334.js"><link rel="prefetch" href="/TIL/assets/js/116.e55a7de1.js"><link rel="prefetch" href="/TIL/assets/js/117.908745fd.js"><link rel="prefetch" href="/TIL/assets/js/118.c6348df6.js"><link rel="prefetch" href="/TIL/assets/js/119.64f5bdeb.js"><link rel="prefetch" href="/TIL/assets/js/120.a9707e85.js"><link rel="prefetch" href="/TIL/assets/js/121.a44e7681.js"><link rel="prefetch" href="/TIL/assets/js/122.8351dca5.js"><link rel="prefetch" href="/TIL/assets/js/123.250a1ace.js"><link rel="prefetch" href="/TIL/assets/js/124.5352e353.js"><link rel="prefetch" href="/TIL/assets/js/125.9eb7898e.js"><link rel="prefetch" href="/TIL/assets/js/126.5bc394f6.js"><link rel="prefetch" href="/TIL/assets/js/127.dfe197ec.js"><link rel="prefetch" href="/TIL/assets/js/128.27d4e3aa.js"><link rel="prefetch" href="/TIL/assets/js/129.9b1934fa.js"><link rel="prefetch" href="/TIL/assets/js/130.230e73b9.js"><link rel="prefetch" href="/TIL/assets/js/131.b687d957.js"><link rel="prefetch" href="/TIL/assets/js/132.da86ec6e.js"><link rel="prefetch" href="/TIL/assets/js/133.0cf84e9c.js"><link rel="prefetch" href="/TIL/assets/js/134.c0e495c8.js"><link rel="prefetch" href="/TIL/assets/js/135.847b7b65.js"><link rel="prefetch" href="/TIL/assets/js/136.a722a404.js"><link rel="prefetch" href="/TIL/assets/js/137.91a8caff.js"><link rel="prefetch" href="/TIL/assets/js/138.204c286a.js"><link rel="prefetch" href="/TIL/assets/js/139.7607e446.js"><link rel="prefetch" href="/TIL/assets/js/140.3ce71721.js"><link rel="prefetch" href="/TIL/assets/js/141.1179602e.js"><link rel="prefetch" href="/TIL/assets/js/142.03a4ce6f.js"><link rel="prefetch" href="/TIL/assets/js/143.08a730e5.js"><link rel="prefetch" href="/TIL/assets/js/144.4b75dff9.js"><link rel="prefetch" href="/TIL/assets/js/145.2e97e1c6.js"><link rel="prefetch" href="/TIL/assets/js/146.59712620.js"><link rel="prefetch" href="/TIL/assets/js/147.c9a03fa1.js"><link rel="prefetch" href="/TIL/assets/js/148.7048022a.js"><link rel="prefetch" href="/TIL/assets/js/149.ad6d82f1.js"><link rel="prefetch" href="/TIL/assets/js/150.5bf0c9db.js"><link rel="prefetch" href="/TIL/assets/js/151.0a354404.js"><link rel="prefetch" href="/TIL/assets/js/152.32cb3112.js"><link rel="prefetch" href="/TIL/assets/js/153.dd3d36ed.js"><link rel="prefetch" href="/TIL/assets/js/154.cac78cae.js"><link rel="prefetch" href="/TIL/assets/js/155.11b8d03f.js"><link rel="prefetch" href="/TIL/assets/js/157.ab201353.js"><link rel="prefetch" href="/TIL/assets/js/158.e4094a16.js"><link rel="prefetch" href="/TIL/assets/js/159.c39a4142.js"><link rel="prefetch" href="/TIL/assets/js/160.5685bf8e.js"><link rel="prefetch" href="/TIL/assets/js/161.595252aa.js"><link rel="prefetch" href="/TIL/assets/js/162.87c30246.js"><link rel="prefetch" href="/TIL/assets/js/163.e1a39681.js"><link rel="prefetch" href="/TIL/assets/js/164.b87ea3a5.js"><link rel="prefetch" href="/TIL/assets/js/165.e7505246.js"><link rel="prefetch" href="/TIL/assets/js/166.1b1e6782.js"><link rel="prefetch" href="/TIL/assets/js/167.10008180.js"><link rel="prefetch" href="/TIL/assets/js/168.1ca90afc.js"><link rel="prefetch" href="/TIL/assets/js/169.57b22168.js"><link rel="prefetch" href="/TIL/assets/js/170.a3541562.js"><link rel="prefetch" href="/TIL/assets/js/171.cb00b8ae.js"><link rel="prefetch" href="/TIL/assets/js/172.d3f0abc8.js"><link rel="prefetch" href="/TIL/assets/js/173.be940dfc.js"><link rel="prefetch" href="/TIL/assets/js/174.1e3e9789.js"><link rel="prefetch" href="/TIL/assets/js/175.6440aa76.js"><link rel="prefetch" href="/TIL/assets/js/176.0ce3977b.js"><link rel="prefetch" href="/TIL/assets/js/177.57494be3.js"><link rel="prefetch" href="/TIL/assets/js/178.dfae39e8.js"><link rel="prefetch" href="/TIL/assets/js/179.5cdc1124.js"><link rel="prefetch" href="/TIL/assets/js/180.074b82c6.js"><link rel="prefetch" href="/TIL/assets/js/181.7416416f.js"><link rel="prefetch" href="/TIL/assets/js/182.cbf3ffbe.js"><link rel="prefetch" href="/TIL/assets/js/183.6f9af53e.js"><link rel="prefetch" href="/TIL/assets/js/184.995ee3db.js"><link rel="prefetch" href="/TIL/assets/js/185.adf3d200.js"><link rel="prefetch" href="/TIL/assets/js/186.a806f41a.js"><link rel="prefetch" href="/TIL/assets/js/187.2993ac4d.js"><link rel="prefetch" href="/TIL/assets/js/188.565f3962.js"><link rel="prefetch" href="/TIL/assets/js/189.3c5dea79.js"><link rel="prefetch" href="/TIL/assets/js/190.a31763bc.js"><link rel="prefetch" href="/TIL/assets/js/191.805a9931.js"><link rel="prefetch" href="/TIL/assets/js/192.39e866b4.js"><link rel="prefetch" href="/TIL/assets/js/193.94d1c999.js"><link rel="prefetch" href="/TIL/assets/js/194.90b6ab9f.js"><link rel="prefetch" href="/TIL/assets/js/195.3874e41d.js"><link rel="prefetch" href="/TIL/assets/js/196.88ab552d.js"><link rel="prefetch" href="/TIL/assets/js/197.1d2337a7.js"><link rel="prefetch" href="/TIL/assets/js/198.0b3307f9.js"><link rel="prefetch" href="/TIL/assets/js/199.38265e54.js"><link rel="prefetch" href="/TIL/assets/js/200.bc00804e.js"><link rel="prefetch" href="/TIL/assets/js/201.19ac46ff.js"><link rel="prefetch" href="/TIL/assets/js/202.4d9b61c7.js"><link rel="prefetch" href="/TIL/assets/js/203.d579dd6f.js"><link rel="prefetch" href="/TIL/assets/js/204.a43dc905.js"><link rel="prefetch" href="/TIL/assets/js/205.447c148e.js"><link rel="prefetch" href="/TIL/assets/js/206.c27160a7.js"><link rel="prefetch" href="/TIL/assets/js/207.d0e3ac80.js"><link rel="prefetch" href="/TIL/assets/js/208.8bc00da3.js"><link rel="prefetch" href="/TIL/assets/js/209.0c88cf86.js"><link rel="prefetch" href="/TIL/assets/js/210.10f91a5a.js"><link rel="prefetch" href="/TIL/assets/js/211.540c2b3d.js"><link rel="prefetch" href="/TIL/assets/js/212.c106f161.js"><link rel="prefetch" href="/TIL/assets/js/213.c2a13ef4.js"><link rel="prefetch" href="/TIL/assets/js/214.2d3e7443.js"><link rel="prefetch" href="/TIL/assets/js/215.3b9d08f6.js"><link rel="prefetch" href="/TIL/assets/js/216.1d8962a2.js"><link rel="prefetch" href="/TIL/assets/js/217.136873b1.js"><link rel="prefetch" href="/TIL/assets/js/218.c57cb97b.js"><link rel="prefetch" href="/TIL/assets/js/219.11919a72.js"><link rel="prefetch" href="/TIL/assets/js/220.354e0213.js"><link rel="prefetch" href="/TIL/assets/js/221.42ca2995.js"><link rel="prefetch" href="/TIL/assets/js/222.c467815f.js"><link rel="prefetch" href="/TIL/assets/js/223.f91eb0d3.js"><link rel="prefetch" href="/TIL/assets/js/224.103f4d22.js"><link rel="prefetch" href="/TIL/assets/js/225.67c4f5c2.js">
    <link rel="stylesheet" href="/TIL/assets/css/226.styles.c95da30a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/TIL/" class="home-link router-link-active"><!----><span class="site-name">
      Today Yurim Learned
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/milooy/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://milooy.wordpress.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/milooy/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://milooy.wordpress.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>React</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Daily Coding</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>JavaScript</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Angular</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Javascript Testing</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>CSS</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Google Analytics</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Data structure and Algorithm</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Django</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/TIL/Django/digging-into-django.html" class="sidebar-link">Code School: Digging into Django</a></li><li><a href="/TIL/Django/django-aggregation.html" class="sidebar-link">Django Aggregation</a></li><li><a href="/TIL/Django/django-bower-grunt.html" class="sidebar-link">상황</a></li><li><a href="/TIL/Django/django-cache.html" class="sidebar-link">Django Cache</a></li><li><a href="/TIL/Django/django-migration-conflict.html" class="sidebar-link">[장고] Migration Conflict</a></li><li><a href="/TIL/Django/django-models.html" class="sidebar-link">Django Models</a></li><li><a href="/TIL/Django/django-pinkfong-tv.html" class="sidebar-link">장고로 웹 만들기 with 핑크퐁 TV</a></li><li><a href="/TIL/Django/django-queries.html" class="sidebar-link">Making Queries</a></li><li><a href="/TIL/Django/django-querysets.html" class="sidebar-link">Django Querysets</a></li><li><a href="/TIL/Django/django-resize-image.html" class="sidebar-link">[Django]서버사이드 이미지 크롭/리사이징 하기</a></li><li><a href="/TIL/Django/django-seperate-settings-and-secret-file.html" class="sidebar-link">장고 settings 파일 &amp; 설정 변수 분리</a></li><li><a href="/TIL/Django/django-social-auth-add-profile-page.html" class="sidebar-link">django social auth 프로필 추가 페이지 제작</a></li><li><a href="/TIL/Django/django-social-auth.html" class="sidebar-link">장고 페이스북 가입 달기</a></li><li><a href="/TIL/Django/django-url.html" class="sidebar-link">의문</a></li><li><a href="/TIL/Django/django.html" class="sidebar-link">django girls</a></li><li><a href="/TIL/Django/djnago-admin.html" class="sidebar-link">Django admin</a></li><li><a href="/TIL/Django/extend-django-user-model.html" class="sidebar-link">장고 유저 모델 확장하기</a></li><li><a href="/TIL/Django/how-to-response-template-in-django.html" class="sidebar-link">의문</a></li><li><a href="/TIL/Django/pass-data-through-redirect-in-django.html" class="sidebar-link">상황</a></li><li><a href="/TIL/Django/react-with-django-rest-framework.html" class="sidebar-link">[서버부터 프론트까지] React와 Django로 웹 서비스 뚝딱 세팅하기 (feat. Webpack, Redux, django rest framework, PWA)</a></li><li><a href="/TIL/Django/two-scoops-of-django.html" class="active sidebar-link">Two scoops of django</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#김승진님-역자-만남" class="sidebar-link">김승진님 역자 만남</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#intro" class="sidebar-link">Intro</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#_1-코딩-스타일" class="sidebar-link">1. 코딩 스타일</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#_2-최적화된-장고-환경-꾸미기" class="sidebar-link">2. 최적화된 장고 환경 꾸미기</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#_3-어떻게-장고-프로젝트를-구성할-것인가" class="sidebar-link">3. 어떻게 장고 프로젝트를 구성할 것인가</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#_4-장고-앱-디자인의-기본" class="sidebar-link">4. 장고 앱 디자인의 기본</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#_5-settings와-requirements파일" class="sidebar-link">5. settings와 requirements파일</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#_6-장고에서-모델-이용하기" class="sidebar-link">6. 장고에서 모델 이용하기</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#_7-쿼리와-데이터베이스-레이어" class="sidebar-link">7. 쿼리와 데이터베이스 레이어</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#_8-함수-기반-뷰와-클래스-기반-뷰" class="sidebar-link">8. 함수 기반 뷰와 클래스 기반 뷰</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#_9-함수-기반-뷰의-모범적-이용" class="sidebar-link">9. 함수 기반 뷰의 모범적 이용</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#_10-클래스-기반-뷰의-모범적-이용" class="sidebar-link">10. 클래스 기반 뷰의 모범적 이용</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#_11-장고-폼의-기초" class="sidebar-link">11. 장고 폼의 기초</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#_16-rest-api-구현하기" class="sidebar-link">16. REST API 구현하기</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#_17-rest-api-이용하기" class="sidebar-link">17. REST API 이용하기</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#_18-장고-코어-모듈을-교체할-때-주의점" class="sidebar-link">18. 장고 코어 모듈을 교체할 때 주의점</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#_19-장고-어드민-이용하기" class="sidebar-link">19. 장고 어드민 이용하기</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#_21-장고의-비법-소스-서드-파티-패키지들" class="sidebar-link">21. 장고의 비법 소스: 서드 파티 패키지들</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#_22-테스트-정말-거추장스럽고-낭비일까" class="sidebar-link">22. 테스트, 정말 거추장스럽고 낭비일까?</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#_24-장고-성능-향상시키기" class="sidebar-link">24. 장고 성능 향상시키기</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#_26-장고-보안의-실전-방법론" class="sidebar-link">26. 장고 보안의 실전 방법론</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#_27-로깅-누구를-위한-것인가" class="sidebar-link">27. 로깅 - 누구를 위한 것인가</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#_28-시그널-이용-사례와-시그널을-피할-수-있는-기술들" class="sidebar-link">28. 시그널: 이용 사례와 시그널을 피할 수 있는 기술들</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#_29-유틸리티들에-대해" class="sidebar-link">29. 유틸리티들에 대해</a></li><li class="sidebar-sub-header"><a href="/TIL/Django/two-scoops-of-django.html#_30-배포-paas" class="sidebar-link">30. 배포: PaaS</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>ETC</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Git</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Module Bundler</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>iOS</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>jQuery</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>MarkUp</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Network</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Python</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="two-scoops-of-django"><a href="#two-scoops-of-django" aria-hidden="true" class="header-anchor">#</a> Two scoops of django</h1><h2 id="김승진님-역자-만남"><a href="#김승진님-역자-만남" aria-hidden="true" class="header-anchor">#</a> 김승진님 역자 만남</h2><ul><li>FANCY 개발자는 15명</li><li>쿼리최적화랑 캐시만 잘해도 반은 먹고간다</li><li>국제화&amp;현지화=&gt; 프로젝트 시작할때 해야한다</li><li>질문
<ul><li>서버 업데이트 시간</li><li>인기순 정렬 // 실시간이라는건 존재하지 않아요(?)
<ul><li>캐시로 해라. 유연하게 생각.</li></ul></li><li>FANCY 디지털 노마드 근무시간: 5~6시 퇴근</li><li>소통 방법</li></ul></li></ul><h2 id="intro"><a href="#intro" aria-hidden="true" class="header-anchor">#</a> Intro</h2><ul><li>핵심 개념
<ul><li>Keep It Simple, Stupid</li><li>모델은 크게, 유틸리티는 모듈로, 뷰는 가볍게, 템플릿은 단순하게
<ul><li>뷰와 템플릿을 제외한 다른 부분에 더 많은 로직 넣는 것을 추천.</li></ul></li><li><a href="https://12factor.net/ko/" target="_blank" rel="noopener noreferrer">12팩터 앱<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>: 웹 기반 애플리케이션 디자인의 통합 전략.
<ul><li>확장 가능하고 배포 가능한 앱을 만드는 방법론</li><li>코드베이스
<ul><li>버전 관리되는 하나의 코드베이스, 다양한 배포</li><li>코드베이스는 하나여야 하지만, 배포는 여러개여야 한다.</li><li>배포: 앱의 실행중인 인스턴스(store-test, store, 그들 사이에도 3개 인스턴스. 아마존 ec2)</li><li>배포마다 다른 버전이 활성화, 코드베이스 자체는 모든 배포에 대해 동일</li></ul></li><li>종속성
<ul><li>모든 종속성 엄격히 선언</li><li>시스템에 특정 패키지가 암묵적으로 존재하는 것에 절대 의존 ㄴ. 내 로컬에 페이지네이션 깔고 requirements.txt</li><li>gemfile</li><li>pip: 종속성 선언 위해 사용</li><li>Virtualenv: 종속성 분리 위해 사용.</li><li>뉴 개발자가 종속성 설치 명령어 하나로 할 수 있다.</li></ul></li><li>설정
<ul><li>배포마다 달라질 수 있는 설정을 코드 말고 환경변수에 저장</li><li>어떠한 인증정보도 유출시키지 않고 코드베이스가 지금 당장 오픈 소스가 될 수 있는지?</li><li>코드 저장소에 환경변수 올리지 않음.</li></ul></li><li>백엔드 서비스
<ul><li>리소스는 자유롭게 배포에 연결되거나 분리될 수 있다</li><li>애플리케이션 코드 수정하지 않고 로컬에서 관리되는 MySQL DB를 서드파티에서 관리되는 Amazon RDS로 전환할 수 있어야 함.</li><li>설정에 있는 리소스 핸들만 변경하면 됨.</li></ul></li><li>빌드, 릴리즈, 실행
<ul><li>세 단계를 엄격히 분리. 릴리즈는 추가만 될 수 있음</li><li>빌드: 코드 저장소를 '빌드'라는 실행 가능한 번들로 변환</li><li>릴리즈: 빌드에서 만들어진 빌드랑 배포의 현재 설정 결합. 실행환경에서 바로 실행될 수 있게 준비됨.</li><li>실행 단계(런타임): 애플리케이션을 실행 환경에서 돌아가게 함.</li><li>이전 릴리즈로 되돌릴 수 있는 롤백 기능을 배포 도구에서 제공.</li><li>모든 릴리즈는 유니크한 아이디.</li><li>한번 만들어진 릴리즈는 변경 불가. 새로운 릴리즈 만들어야 함.</li></ul></li><li>프로세스
<ul><li>프로세스는 stateless하며, 아무것도 공유 X</li><li>유지될 필요가 있는 모든 데이터는 DB같은 안정된 백엔드 서비스에 저장</li></ul></li><li>포트 바인딩
<ul><li>실행환경에 대한 런타임 인젝션에 의존 X</li><li>포트를 바인딩해 HTTP 서비스로 공개되며 그 포트로 들어오는 요청을 기다림.</li></ul></li><li>동시성
<ul><li>자원이 제때제때 효율적으로 줄 수 있도록 수평적 확장</li><li>인스턴스 3개씩 돌리고.</li><li>뭐하고 다음에 뭐하고 하면 중간에 죽으면 다 죽음.</li><li>HTTP요청은 웹 프로세스가, 오래 걸리는 백그라운드 작업은 worker가</li></ul></li><li>폐기 가능
<ul><li>하드웨어 에러에 의한 갑작스러운 죽음에도 견고. 작업을 큐로 되돌림.</li></ul></li><li>dev/prod 일치
<ul><li>development, staging, production환경 비슷하게 유지</li></ul></li><li>로그
<ul><li>로그: 실행중인 프로세스와 백그라운드 아웃풋 스트림으로부터 수집된 이벤트가 시간 순으로 정렬된 스트림.</li><li>장기간에 걸쳐 앱의 동작을 조사할 수 있는 강력함과 유연성을 갖게 됨.</li></ul></li><li>Admin 프로세스
<ul><li><code>manage.py migrate</code>같은 maintenance작업을 일회성 프로세스로 실행. ssh로 뚫던가.</li></ul></li></ul></li></ul></li></ul><hr><h2 id="_1-코딩-스타일"><a href="#_1-코딩-스타일" aria-hidden="true" class="header-anchor">#</a> 1. 코딩 스타일</h2><ul><li>읽기 쉬운 코드
<ul><li>축약적이거나 함축적인 변수명은 피한다</li><li>함수 인자의 이름들은 꼭 써 준다</li><li>클래스와 메서드를 문서화한다</li><li>코드에 주석은 꼭 달도록 한다</li><li>재사용 가능한 함수 또는 메서드 안에서 반복되는 코드들은 리팩터링을 해둔다.</li><li>함수와 메서드는 가능한 한 작은 크기를 유지한다. 어림잡아 스크롤 없이 읽을 수 있는 길이가 적합</li></ul></li></ul><blockquote><p>한동안 잊고 지낸 코드라도 어느 순간 다시 보았을 때 쉽고 빠르게 내용 이해하기 위한 것.</p></blockquote><ul><li>PEP8
<ul><li>파이썬 공식 스타일 가이드
<ul><li>들여쓰기는 스페이스 4칸</li><li>최상위 함수와 클래스 선언 사이 2줄</li><li>클래스 안에서 메서드간엔 한 줄</li></ul></li><li>한 줄 79글자?
<ul><li>오픈 소스가 아닌 프로젝트에선 괜찮음</li><li>프라이빗 프로젝트에 한해서는 99칼럼까지?</li><li>79자에 맞추려고 이름 줄이지 마라.</li></ul></li><li>임포트 순서
<ul><li><ol><li>표준 라이브러리 임포트 <code>from math import sqrt</code></li></ol></li><li><ol start="2"><li>코어 장고 임포트 <code>from django.db import models</code></li></ol></li><li><ol start="3"><li>장고와 무관한 외부 앱 임포트 <code>from django_extensions.db.models import TimeStampedModel</code></li></ol></li><li><ol start="4"><li>프로젝트 앱 임포트 <code>from splits.models import BananaSplit</code></li></ol></li></ul></li></ul></li><li>flake8
<ul><li>코딩 스타일, 코드 품질, 논리적 에러 검증</li></ul></li><li>명시적 성격의 상대 임포트 이용을 추천</li></ul><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> cones<span class="token punctuation">.</span>models <span class="token keyword">import</span> WaffleCone <span class="token comment"># 이렇게 말고</span>
<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> WaffleCone <span class="token comment"># 요렇게 상대경로</span>
</code></pre></div><ul><li>각기 다른 임포트 유형</li></ul><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> core<span class="token punctuation">.</span>views <span class="token keyword">import</span> FoodMixin <span class="token comment"># 절대 임포트. 외부에서 임포트해 현재 앱에서 이용.</span>
<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> WaffleCone <span class="token comment"># 명시적 상대. 다른 모듈에서 임포트해서 현재 앱에서 이용</span>
<span class="token keyword">from</span> models <span class="token keyword">import</span> WaffleCone <span class="token comment"># 암묵적 상대. 종종 다른 모듈에서 임포트해 현재 앱에서 이용할 때 쓰지만 좋은 방법은 아님.</span>
</code></pre></div><ul><li><code>import *</code> 는 피하자
<ul><li>다른 파이썬 모듈의 네임스페이스가 현재 우리가 작업하는 모듈의 네임스페이스에 추가되거나 덮이는 것을 막기 위함.</li></ul></li><li>장고 코딩 스타일
<ul><li><a href="https://docs.djangoproject.com/en/1.8/internals/contributing/writing-code/coding-style/" target="_blank" rel="noopener noreferrer">PEP8 확장<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li>템플릿 블록 이름에 대시 대신 밑줄</li></ul></li></ul><div class="language-python extra-class"><pre class="language-python"><code>patterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    url<span class="token punctuation">(</span>regex<span class="token operator">=</span><span class="token string">'^add-topping/$'</span><span class="token punctuation">,</span> blabla<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'add_topping'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># url 패턴 이름엔 언더스코어. 주소 이름에 대시 쓰는건 무방.</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="html-css-javascript-스타일-가이드"><a href="#html-css-javascript-스타일-가이드" aria-hidden="true" class="header-anchor">#</a> HTML, CSS, Javascript 스타일 가이드</h3><ul><li>자바스크립트 스타일 가이드
<ul><li>https://github.com/rwaldron/idiomatic.js</li><li>https://github.com/madrobby/pragmatic.js</li><li>https://github.com/airbnb/javascript</li><li>http://javascript.crockford.com/code.html</li></ul></li><li>JSCS
<ul><li>자바스크립트 코드 스타일 린터</li><li>http://jscs.info/</li></ul></li><li>HTML, CSS 스타일 가이드
<ul><li>http://codeguide.co/</li><li>https://github.com/necolas/idiomatic-css</li></ul></li><li>CSS Comb
<ul><li>CSS용 코딩 스타일 포맷 도구</li><li>http://csscomb.com/</li></ul></li></ul><hr><h2 id="_2-최적화된-장고-환경-꾸미기"><a href="#_2-최적화된-장고-환경-꾸미기" aria-hidden="true" class="header-anchor">#</a> 2. 최적화된 장고 환경 꾸미기</h2><ul><li>같은 데이터베이스를 이용하라
<ul><li>e.g. 로컬에선 sqlite3, 실제는 MySQL 이런 예 피하기</li><li>운영 데이터를 완전히 똑같이 로컬에서 구동하기 힘듦</li><li>다른 종류 데이터베이스 사이엔 다른 성격의 필드 타입과 제약 조건이 존재</li><li>픽스처는 마법을 부리지 않는다</li><li><ul><li>많이 선호하는 조합: Django + PostgreSQL</li></ul></li></ul></li><li>pip, virtualenv 이용하기</li><li>버전 컨트롤 시스템 이용하기</li><li>(선택)동일한 환경 구성</li></ul><hr><h2 id="_3-어떻게-장고-프로젝트를-구성할-것인가"><a href="#_3-어떻게-장고-프로젝트를-구성할-것인가" aria-hidden="true" class="header-anchor">#</a> 3. 어떻게 장고 프로젝트를 구성할 것인가</h2><ul><li>기본 구성
<ul><li><code>repository_root</code> &gt; <code>django_project_root</code> &gt; <code>configuration_root</code></li><li>최상위 레벨: 저장소 루트
<ul><li>최상위 절대 루트. django project root 이외에 README, .gitignore, 배포에 필요한 파일 등 중요한 내용 위치.</li></ul></li><li>두 번째 레벨: 프로젝트 루트
<ul><li>장고 프로젝트 소스들 위치.</li><li>모든 파이썬 코드는 이 아래에 위치.</li></ul></li><li>세 번째 레벨: 설정 루트
<ul><li>settings 모듈과 기본 URLConf(urls.py)가 저장되는 장소.</li><li>이 디렉터리는 유효한 파이썬 패키지 형태여야 한다 (<strong>init</strong>.py모듈이 존재해야 한다는 의미기도 한다.)</li><li><code>./manage.py start-project</code>명령으로 생성된 파일의 일부</li></ul></li></ul></li></ul><hr><h2 id="_4-장고-앱-디자인의-기본"><a href="#_4-장고-앱-디자인의-기본" aria-hidden="true" class="header-anchor">#</a> 4. 장고 앱 디자인의 기본</h2><ul><li>용어 정리
<ul><li>장고 프로젝트: 장고 웹 프레임워크를 기반으로 한 웹 애플리케이션</li><li>장고 앱: 프로젝트의 한 기능을 표현하기 위해 디자인된 작은 라이브러리. 장고 프로젝트는 다수의 장고 앱으로 구성. 때때로 외부 장고 패키지를 지칭하기도 함.
<ul><li>앱의 중심이 되는 모델 이름의 복수 형태로 네이밍함. e.g. animals, flavors...</li></ul></li><li>INSTALLED_APPS: 프로젝트에서 이용하려고 INSTALLED_APPS 세팅에 설정한 장고 앱들</li><li>서드 파티 장고 패키지: 파이썬 패키지 도구들에 의해 패키지화된, 재사용 가능한 플러그인 형태로 이용 가능한 장고 앱.</li></ul></li><li>비공통 앱 모듈
<ul><li>behaviors.py: 모델 믹스인 위치에 대한 옵션</li><li>constants.py: 앱 레벨에서 이용되는 세팅을 저장하는 장소.</li><li>context_processors.py</li><li>decorators.py</li><li>db/ : 여러 프로젝트에서 이용되는 커스텀 모델이나 컴포넌트</li><li>exceptions</li><li>fields.py: 폼 필드 이용에 쓰임.</li><li>factories.py: 테스트 데이터 팩터리 파일</li><li>helpers.py: 헬퍼 함수. 뷰랑 모델에서 추출한 코드를 저장. utils.py랑 비슷.</li><li>managers.py: models.py가 너무 커질 경우, 일반적인 해결책으로 커스텀 모델 매니저가 여기로 이동.</li><li>signals.py: 커스텀 시그널을 넣기 유용</li><li>utils.py</li><li>viewmixins.py</li></ul></li></ul><hr><h2 id="_5-settings와-requirements파일"><a href="#_5-settings와-requirements파일" aria-hidden="true" class="header-anchor">#</a> 5. settings와 requirements파일</h2><p>세팅값의 새로운 적용은 서버를 재시작해야만 가능. 아래는 최선의 장고 설정 방법.</p><ul><li>버전 컨트롤 시스템으로 모든 설정 파일을 관리해야 한다.
<ul><li>날짜, 시간 등 세팅 변화에 대한 기록이 반드시 문서화되어야 함</li></ul></li><li>반복되는 설정 없애기
<ul><li>기본 세팅 파일로부터 상속</li></ul></li><li>암호나 비밀 키 등은 안전하게 보관
<ul><li>민감한 보안 관련 사항은 버전 컨트롤 시스템에서 제외</li></ul></li></ul><h3 id="버전-관리되지-않는-로컬-세팅은-피하라"><a href="#버전-관리되지-않는-로컬-세팅은-피하라" aria-hidden="true" class="header-anchor">#</a> 버전 관리되지 않는 로컬 세팅은 피하라</h3><p>이전엔 <code>local_settings</code>로 보안과 관련된 세팅은 빼두었다.
<code>SECRET_KEY</code>같은 것들은 다 빼야 한다. 아마존 API 키, 비밀번호, OAuth 토큰 등 설정 변수
하지만 문제는</p><ul><li>모든 머신에 버전 컨트롤에 기록되지 않는 코드가 존재하게 됨.</li><li>운영 환경 문제점 로컬에서 구현해보려 죽쑤다가 local_setting값 때문이란걸 알게 됨</li><li>여러 팀원이 서로의 local_settings.py를 복사해서 여기저기 붙여 쓴다.</li></ul><h3 id="여러-개의-settings-파일-이용하기"><a href="#여러-개의-settings-파일-이용하기" aria-hidden="true" class="header-anchor">#</a> 여러 개의 settings 파일 이용하기</h3><p>하나의 파일보단 <code>settings/</code> 디렉터리 아래에 여러 개의 셋업 파일을 구성하여 이용.
(각 세팅 모듈은 그에 해당하는 독립적인 requirements파일을 필요)</p><div class="language-shell extra-class"><pre class="language-shell"><code>settings/
    __init__.py
 ㅉ <span class="token comment"># 운영 서버에서 실제로 운영되는 세팅 파일</span>
</code></pre></div><p>이는 다음과 같이 실행시킨다.</p><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># settings/local.py세팅 파일로 셸 시작</span>
python manage.py shell --settings<span class="token operator">=</span>twoscoops.settings.local

<span class="token comment"># settings/local.py세팅 파일로 서버 구동</span>
python manage.py runserver --settings<span class="token operator">=</span>twoscoops.settings.local
</code></pre></div><p>이렇게 바꾼 후에는 <code>project_name/wsgi.py</code>와 <code>manage.py</code>에 기본 구동 세팅을 설정해줘야 한다.</p><div class="language-python extra-class"><pre class="language-python"><code>os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;project_name.settings.local&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p><a href="http://stackoverflow.com/questions/19128540/django-improperlyconfigured-the-secret-key-setting-must-not-be-empty" target="_blank" rel="noopener noreferrer">참고 링크<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><h3 id="개발-환경의-settings-파일-예제"><a href="#개발-환경의-settings-파일-예제" aria-hidden="true" class="header-anchor">#</a> 개발 환경의 settings 파일 예제</h3><div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># settings/local.py</span>
<span class="token keyword">from</span> <span class="token punctuation">.</span>base <span class="token keyword">import</span> <span class="token operator">*</span> <span class="token comment"># 베이스 세팅 받아오기</span>

DEBUG <span class="token operator">=</span> <span class="token boolean">True</span>
EMAIL_BACKEND <span class="token operator">=</span> <span class="token string">'django.core.mail.backends.console.EmailBackend'</span>

DATABASES <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;default&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;ENGINE&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;django.db.backends.postgresql_psycopg2&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;NAME&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;twoscoops&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;USER&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;PASSWORD&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;HOST&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;PORT&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

INSTALLED_APPS <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token string">&quot;debug_toolbar&quot;</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="코드에서-설정-분리하기"><a href="#코드에서-설정-분리하기" aria-hidden="true" class="header-anchor">#</a> 코드에서 설정 분리하기</h3><p>환경 변수 패턴.</p><ul><li>걱정 없이 세팅 파일을 버전 컨트롤 시스템에 추가할 수 있다.</li><li>파이썬 코드 수정 없이 시스템 관리자들이 프로젝트 코드를 쉽게 배치할 수 있다.</li></ul><p>맥이나 리눅스 배포판의 경우 다음 구문을 <code>bashrc</code>, <code>.bash_profile</code>, 또는 <code>.profile</code>의 뒷부분에 추가하면 된다.</p><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">export</span> SOME_SECRET_KEY<span class="token operator">=</span>1c3-sadf-123fsaf
<span class="token function">export</span> JAYJIN_FREEZER_KEY <span class="token operator">=</span> weljfak-123r-1faldk
</code></pre></div><p>운영 환경에서 환경 변수를 세팅하기
히로쿠는 다음과 같이 개발 환경의 환경 변수들을 지정한다.</p><div class="language-shell extra-class"><pre class="language-shell"><code>heroku config:set SOME_SECTRET_KEY<span class="token operator">=</span>123-1sdfa-123
</code></pre></div><p>파이썬에서 환경 변수에 접근하려면</p><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">import</span> os
SOME_SECRET_KEY <span class="token operator">=</span> os.environ<span class="token punctuation">[</span><span class="token string">&quot;SOME_SECRET_KEY&quot;</span><span class="token punctuation">]</span>
</code></pre></div><p>비밀 키가 존재하지 않을 때 예외 처리하기</p><div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># settings/base.py</span>
<span class="token keyword">import</span> os

<span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ImproperlyConfigured

<span class="token keyword">def</span> <span class="token function">get_env_variable</span><span class="token punctuation">(</span>var_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span>var_name<span class="token punctuation">]</span>
    <span class="token keyword">except</span> KeyError<span class="token punctuation">:</span>
        error_msg <span class="token operator">=</span> <span class="token string">&quot;Set the {} environmental variable&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>var_name<span class="token punctuation">)</span>
        <span class="token keyword">raise</span> ImporperlyConfigured<span class="token punctuation">(</span>error_msg<span class="token punctuation">)</span>
</code></pre></div><h3 id="환경-변수를-이용할-수-없을-때"><a href="#환경-변수를-이용할-수-없을-때" aria-hidden="true" class="header-anchor">#</a> 환경 변수를 이용할 수 없을 때</h3><p>아파치, Nginx기반 환경에서도 특정 경우에 한해 환경 변수를 이용하는 방법이 작동되지 않는다.
이럴 경우 <code>비밀 파일 패턴</code>방법을 이용한다. JSON, Config, YAML 또는 XML로 작성하고 gitignore에 추가.</p><div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;FILENAME&quot;</span><span class="token operator">:</span> <span class="token string">&quot;secrets.json&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;SECRET_KEY&quot;</span><span class="token operator">:</span> <span class="token string">&quot;비밀이당&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;DATABASE_HOST&quot;</span><span class="token operator">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;PORT&quot;</span><span class="token operator">:</span> <span class="token string">&quot;5432&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>settings.py엔 다음과 같이 추가.</p><div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># settings/base.py</span>
<span class="token keyword">import</span> os

<span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ImproperlyConfigured

<span class="token comment"># JSON기반 비밀 모듈</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;secret.json&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
secrets <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">get_env_variable</span><span class="token punctuation">(</span>setting<span class="token punctuation">,</span> secrets <span class="token operator">=</span> secrets<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> os<span class="token punctuation">.</span>secrets<span class="token punctuation">[</span>setting<span class="token punctuation">]</span>
    <span class="token keyword">except</span> KeyError<span class="token punctuation">:</span>
        error_msg <span class="token operator">=</span> <span class="token string">&quot;Set the {0} environmental variable&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>setting<span class="token punctuation">)</span>
        <span class="token keyword">raise</span> ImporperlyConfigured<span class="token punctuation">(</span>error_msg<span class="token punctuation">)</span>

SECRET_KEY <span class="token operator">=</span> get_secret<span class="token punctuation">(</span><span class="token string">&quot;SECRET_KEY&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="여러-개의-requirements-txt-추가하기"><a href="#여러-개의-requirements-txt-추가하기" aria-hidden="true" class="header-anchor">#</a> 여러 개의 requirements.txt 추가하기</h3><p>그 환경에 필요한 컴포넌트만 설치</p><div class="language- extra-class"><pre class="language-text"><code>requirements/
    base.txt
    local.txt
    staging.txt
    production.txt
</code></pre></div><p>base.txt예제</p><div class="language- extra-class"><pre class="language-text"><code>Django==1.8.0
psycopg2=2.6
</code></pre></div><p>local.txt예제</p><div class="language- extra-class"><pre class="language-text"><code>-r base.txt # base.txt requirements 파일 포함
coverage==3.7.1
django-debug-toolbar==1.3.0
</code></pre></div><p>ci.txt 예제</p><div class="language- extra-class"><pre class="language-text"><code>-r base.txt
coverage==3.7.1
django-jenkins==0.16.4
</code></pre></div><p>설치하기</p><div class="language- extra-class"><pre class="language-text"><code>pip install -r requirements/local.txt
</code></pre></div><hr><h2 id="_6-장고에서-모델-이용하기"><a href="#_6-장고에서-모델-이용하기" aria-hidden="true" class="header-anchor">#</a> 6. 장고에서 모델 이용하기</h2><ul><li>유용한 패키지들
<ul><li>django-model-utils: TimeStampedModel같은 일반적인 패턴 처리 이용</li><li>django-extensions: 모든 앱에 모델 클래스를 자동으로 로드해 주는 <code>shell_plus</code>라는 관리 명령 제공. 단점은 너무 다양한 기능 포함</li></ul></li><li>시작하기
<ul><li>모델이 너무 많으면 앱을 나눈다
<ul><li>각 앱이 가진 모델의 수는 5개 넘지 말아야 한다</li></ul></li><li>모델 상속에 주의하자
<ul><li>상속을 이용하지 않는다
<ul><li>공통 필드 있을 때 그 모델 모두에 필드 만듦.</li><li>pros: 한눈에 보기 쉬움</li><li>cons: 모델 간 중복되는 테이블 많으면 지속적 관리 어려움</li></ul></li><li>추상화 기초 클래스(Abstract base class)
<ul><li>오직 상속받아 생성된 모델들의 테이블만 생성</li><li>pros: 추상화된 클래스에 공통 부분 추려둬서 한 번만 타이핑</li><li>pros: 추가 테이블 생성 x, 여러 테이블에 걸쳐 조인 함으로써 발생하는 성능 저하도 없다</li><li>cons: 부모 클래스를 독립적으로 이용 불가</li></ul></li><li>멀티테이블 상속(multi-table inheritance)
<ul><li>부모와 자식 모델에 대해서 모두 테이블 생성. OneToOne필드는 부모와 자식 간에 적용</li><li>pros: 각 모델에 대해 매칭되는 테이블이 생성. 부모 또는 자식 모델 어디로든지 쿼리 할 수 잇다</li><li>cons: 자식 테이블에 대한 각 쿼리에 대해 부모 테이블로 조인 필요해서 부하 발생. 이용하지 말기를 권한다.</li></ul></li><li>프락시 모델(proxy model)
<ul><li>원래 모델에 대해서만 테이블 생성.</li><li>pros: 각기 다른 파이썬 작용(behavior)을 하는 모델들의 별칭을 가질 수 있다</li><li>cons: 모델의 필드 변경 불가</li></ul></li></ul></li></ul></li></ul><h3 id="모델-상속해보기"><a href="#모델-상속해보기" aria-hidden="true" class="header-anchor">#</a> 모델 상속해보기</h3><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">TimeStampedModel</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    created <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    modified <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        abstract <span class="token operator">=</span> <span class="token boolean">True</span>
</code></pre></div><p>아래 <code>class Meta</code>를 달면 추상화 기초 클래스로 변경해준다.
그럼 마이그레이션 실행할 때 이 테이블이 생성되지 않는다.</p><h3 id="데이터베이스-마이그레이션"><a href="#데이터베이스-마이그레이션" aria-hidden="true" class="header-anchor">#</a> 데이터베이스 마이그레이션</h3><ul><li>생성되는 마이그레이션 갯수에 연연하지 마라. 너무 많아진다면 <code>squashmigrations</code>를 이용하는 것도 방법.</li><li>배포 전에 마이그레이션을 rollback할 수 있는지 확인해보자.</li><li>테이블에 수백만 개의 데이터가 이미 존재한다면 운영서버에서 돌리기 전에 스테이징 서버에서 비슷한 크기의 데이터에 대해 충분히 테스트하자</li><li>MySQL을 이용한다면
<ul><li>스키마 변환 전 데이터베이스를 반드시 백업해둔다. MySQL은 스키마 변경에 대해 트랜잭션을 지원 x. 따라서 롤백이 불가능 &lt;- <code>?</code></li><li>가능하다면 데이터베이스를 변환하기 이전에 프로젝트를 read-only모드로 변경한다 &lt;-<code>?</code></li><li>상당히 큰 테이블의 경우 주의하지 않으면 스키마 변경에 상당한 시간이 걸릴 수 있다. 몇 시간이 걸릴 수도 있음.</li></ul></li></ul><h3 id="장고-모델-디자인"><a href="#장고-모델-디자인" aria-hidden="true" class="header-anchor">#</a> 장고 모델 디자인</h3><ul><li>정규화하기
<ul><li>Database Normalization에 익숙해져야 한다.</li><li>장고 모델 디자인은 항상 정규화로부터 시작. 충분한 시간을 가지고 이미 모델에 포함된 데이터들이 중복되어 다시 다른 모델에 포함되지 않도록 신경써야 함.</li></ul></li><li>캐시와 비정규화
<ul><li>적절한 위치에서 캐시를 세팅하는 건 모델을 비정규화 할 때 발생하는 문제점들을 상당 부분 해결.</li></ul></li><li>반드시 필요한 경우에만 비정규화를 하도록 하자
<ul><li>비정규화 생각하기 이전에 캐시에 대해 좀 더 연구</li></ul></li><li>언제 null을 쓰고 언제 blank를 쓸 것인가
<ul><li>CharField, TextField, SlugField, EmailField, CommaSeperatedIntegerField, UUIDField
<ul><li><code>null=True</code>: 안쓴다. 빈 값은 빈 문자열로 저장. 'null'이란 값이나 ''를 빈 문자열에 대해 반환</li><li><code>blank=True</code>: 쓴다. 빈 값을 허용한다면.</li></ul></li><li>FileField, ImageField
<ul><li><code>null=True</code>: 안쓴다. 장고는 <code>MEDIA_ROOT</code>의 경로를 CharField에 파일 또는 이미지로 저장한다. 같은 패턴이 FileField에도 적용됨.</li><li><code>blank=True</code>: 쓴다. CharField에 적용된 것과 같은 규칙 적용 &lt;-<code>?</code></li></ul></li><li>BooleanField
<ul><li><code>null=True</code>: 안쓴다. 대신 <code>NullBooleanField</code>이용.</li><li><code>blank=True</code>: 안쓴다.</li></ul></li><li>IntegerField, FloatField, DecimalField, DurationField 등
<ul><li><code>null=True</code>: 해당 값이 DB에 NULL로 들어가도 문제 없다면 이용</li><li><code>blank=True</code>: 위젯에서 해당 값이 빈 값을 받아와도 문제가 없다면 이용. null=True랑 같이 이용.</li></ul></li><li>DateTimeField, DateField, TimeField 등
<ul><li><code>null=True</code>: 해당 값이 DB에 NULL로 들어가도 문제 없다면 이용</li><li><code>blank=True</code>: 위젯에서 해당 값이 빈 값 받아와도 문제없다거나 auto_now나 auto_now_add를 이용하고 있다면 이용한다.</li></ul></li><li>ForeignKey, ManyToManyField, OneToOneField
<ul><li><code>null=True</code>: 해당 값이 DB에 NULL로 들어가도 문제 없다면 이용</li><li><code>blank=True</code>: 위젯에서 해당 값이 빈 값 받아와도(e.g. 셀렉트박스) 문제없다면 괜춘 &lt;-<code>?</code></li></ul></li><li>GenericIPAddressField (<em>IPAddress보다 선호</em>)
<ul><li><code>null=True</code>: 해당 값이 DB에 NULL로 들어가도 문제 없다면 이용</li><li><code>blank=True</code>: 위젯에서 해당 값이 빈 값 받아와도 문제없다면 이용</li></ul></li><li>IPAddressField
<ul><li><code>null=True</code>: 사용 x</li><li><code>blank=True</code>: 사용 x</li></ul></li></ul></li><li>언제 BinaryField를 이용할 것인가
<ul><li>raw binary data 또는 byte를 저장하는 필드.</li><li>filter, exclude, 등 SQL액션들이 적용되지 않는다.</li><li>사용 예
<ul><li>메시지팩 형태의 콘텐츠 &lt;-<code>?</code></li><li>원본 센서 데이터</li><li>압축된 데이터</li></ul></li><li>크기가 방대할 수 있고 그로 인해 DB가 느려질 수 있다는 것을 명시
<ul><li>해당 데이터를 파일 형태로 저장하고 FileField에 레퍼런스만 저장하는 방법도 있음</li><li>BinaryField에 파일을 직접 저장하는건 피하자.</li><li>데이터베이스 필드에 파일 직접 저장하는건 피하자 &lt;- <code>?</code></li><li>DB의 읽기/쓰기 속도는 항상 파일 시스템보다 느림.</li><li>DB백업에 드는 공간과 시간이 점점 증가</li><li>파일 자체에 접근하는 데 앱(장고)레이어와 데이터베이스 레이어 둘 다를 거쳐야 한다.</li></ul></li></ul></li><li>범용 관계(generic relations) 피하기
<ul><li>generic relations와 models.field.GenericForiegnKey이용에 부정적.</li><li>Generic Relations: 한 테이블로부터 다른 테이블을 서로 제작 조건이 없는 외부 키(GenericForiegnKey)로 바인딩.</li><li>시간이 흐르며 favorite, ratings...앱을 ForiegnKey와 M2M필드 이용 안해도 구현 &lt;-<code>?</code></li></ul></li></ul><h3 id="모델의-meta-api"><a href="#모델의-meta-api" aria-hidden="true" class="header-anchor">#</a> 모델의 <code>_meta API</code></h3><ul><li>언제 필요하나 &lt;-<code>?</code><ul><li>모델 필드의 리스트를 가져올 때</li><li>모델 특정 필드 클래스 가져올 때(또는 상속 관계나 상속 등을 통해 생성된 정보 가져올 때)</li><li>앞으로 장고 버전들에서 이러한 정보를 어떻게 가져오게 되었는지 확실하게 상수로 남기기를 원할 때</li><li>장고 모델의 자체 검사 도구</li><li>라이브러리 이용해서 특별하게 커스터마이징 된 자신만의 장고 만들 때</li><li>장고 모델 데이터 조정하거나 변경할 수 있는 일종의 관리 도구를 제작할 때</li><li>시각화 또는 분석 라이브러리 제작할 때(e.g. 'foo'라는 단어로 시작하는 필드에 대한 분석 정보)</li></ul></li></ul><h3 id="모델-매니저"><a href="#모델-매니저" aria-hidden="true" class="header-anchor">#</a> 모델 매니저</h3><ul><li>모델에 질의 하면 장고 ORM통하게 되는데 이 때 <code>모델 매니저</code>라는 DB와 연동하는 인터페이스를 호출하게 된다.</li><li>기본적으로 제공하며, 스스로 제작할 수도 있다.</li></ul><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">PublishedManage</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Manager<span class="token punctuation">)</span><span class="token punctuation">:</span>

    use_for_related_fields <span class="token operator">=</span> <span class="token boolean">True</span>

    <span class="token keyword">def</span> <span class="token function">published</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> self<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pub_date__lte<span class="token operator">==</span>timezone<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">FlavorReview</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    review <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span>
    pub_date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 커스텀 모델 매니저는 여기에 추가. 이렇게 해서 오버라이드하는게 명확</span>
    objects <span class="token operator">=</span> PublishedManager<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code>FlavorReview<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
FlavorReview<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>published<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#이렇게 사용</span>
</code></pre></div><h3 id="거대-모델-fat-model-이해하기"><a href="#거대-모델-fat-model-이해하기" aria-hidden="true" class="header-anchor">#</a> 거대 모델(fat model) 이해하기</h3><p>거대 모델 개념: 데이터 관련 코드를 뷰나 템플릿에 넣기보단 모델 메서드, 클래스 메서드, 프로퍼티 혹은 매니저 메서드 안에 넣어서 캡슐화.</p><ul><li>메서드 예
<ul><li><code>Review.create_view(clas, user, rating, title, description)</code>: 리뷰를 생성하는 클래스 메서드. HTML과 REST 뷰에서 호출되는 모델 클래스, 스프레드시트를 처리하는 임포트 도구에서 호출</li><li><code>review.product_average</code>: 리뷰된 프로젝트의 평균 점수를 반환하는 리뷰 인스턴스 속성.</li><li><code>review.found_useful(self, user, yes)</code>: 해당 리뷰가 유용했는지 아닌지 사용자가 기록할 수 있는 메서드.</li></ul></li></ul><p>코드 재사용을 개선할 수 있는 최고의 방법. 대신 너무 커지면 이해하기 어렵고 유지보수하기도 어렵다.</p><ul><li>Mixin
<ul><li>모델 행동은 믹스인을 통한 캡슐화와 구성화의 개념으로 이루어짐.</li><li>모델은 추상화 모델로부터 로직들을 상속받음</li></ul></li><li>stateless한 Helper함수
<ul><li>모델로부터 로직 떼어내 유틸리티 함수로 넣음. 독립적으로 구성하면 로직에 대한 테스트가 좀 더 쉬워짐.</li><li>단점은 해당 함수들이 stateless해서 함수에 더 많은 인자를 필요로 하게 함</li></ul></li><li>모델 행동과 헬퍼 함수</li></ul><hr><h2 id="_7-쿼리와-데이터베이스-레이어"><a href="#_7-쿼리와-데이터베이스-레이어" aria-hidden="true" class="header-anchor">#</a> 7. 쿼리와 데이터베이스 레이어</h2><ul><li>단일 객체에서 get_object_or_404() 이용하기
<ul><li>단일 객체를 가져와서 작업을 하는 세부 페이지 같은 뷰에서는 get()대신에 get_object_or_404()를 이용해라.</li><li>뷰에서만 이용해야 한다. 아니면 특정 데이터 지웠을때 모두 망가지는 경우가 있음.</li></ul></li><li>예외를 일으킬 수 있는 쿼리를 주의하자
<ul><li>ObjectDoesNotExist(어떤 모델 객체에도 이용 가능), DoesnotExist(특정 모델에만 이용 가능)</li><li>MultipleObjectsReturned: 쿼리가 하나 이상 객체 반환되었을 예외경우</li></ul></li><li>쿼리를 명확하게 하기 위해 지연 연산 이용
<ul><li>filter 등으로 여러 줄 된 쿼리는 분리해서 적어준다. 데이터가 정말로 필요하기 전까지는 SQL 호출하지 않기 때문.</li></ul></li><li>고급 쿼리 도구 이용
<ul><li><code>Customer.objects.filter(scopps_ordered__gt=F('store_visits))</code></li></ul></li><li>데이터베이스 함수들</li></ul><p><strong>WIP</strong></p><hr><h2 id="_8-함수-기반-뷰와-클래스-기반-뷰"><a href="#_8-함수-기반-뷰와-클래스-기반-뷰" aria-hidden="true" class="header-anchor">#</a> 8. 함수 기반 뷰와 클래스 기반 뷰</h2><h3 id="url-네임스페이스-이용하기"><a href="#url-네임스페이스-이용하기" aria-hidden="true" class="header-anchor">#</a> URL 네임스페이스 이용하기</h3><p><code>tasting_detail</code> 대신 <code>tastings:detail</code>과 같이 명확한 이름 사용하기</p><div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># urls.py</span>
urlpatterns <span class="token operator">+=</span> <span class="token punctuation">[</span>
    url<span class="token punctuation">(</span>r<span class="token string">'^tastings/'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">'tasting.urls'</span><span class="token punctuation">,</span> namespace<span class="token operator">=</span><span class="token string">'tastings'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token comment"># tastings/views.py</span>
<span class="token keyword">class</span> <span class="token class-name">TasteUpdateView</span><span class="token punctuation">(</span>UpdateView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> Tasting

    <span class="token keyword">def</span> <span class="token function">get_success_url</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> reverse<span class="token punctuation">(</span><span class="token string">&quot;tastings:detail&quot;</span><span class="token punctuation">,</span> kwargs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;pk&quot;</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span><span class="token builtin">object</span><span class="token punctuation">.</span>pk<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># HTML 템플릿</span>
<span class="token punctuation">{</span><span class="token operator">%</span> url <span class="token string">&quot;tastings:detail&quot;</span> taste<span class="token punctuation">.</span>pk <span class="token operator">%</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="urlconf에서-view를-문자열로-지목하지-말자"><a href="#urlconf에서-view를-문자열로-지목하지-말자" aria-hidden="true" class="header-anchor">#</a> urlconf에서 view를 문자열로 지목하지 말자</h3><div class="language-python extra-class"><pre class="language-python"><code>urlpatterns <span class="token operator">=</span> patterns<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span>r<span class="token string">'^$'</span><span class="token punctuation">,</span> <span class="token string">'polls.views.index'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># 이렇게 말고</span>
    url<span class="token punctuation">(</span>r<span class="token string">'^$'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>index<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># 이렇게 써라</span>
<span class="token punctuation">)</span>
</code></pre></div><hr><h2 id="_9-함수-기반-뷰의-모범적-이용"><a href="#_9-함수-기반-뷰의-모범적-이용" aria-hidden="true" class="header-anchor">#</a> 9. 함수 기반 뷰의 모범적 이용</h2><h3 id="함수-기반-뷰로-코드-작성할-때의-가이드라인"><a href="#함수-기반-뷰로-코드-작성할-때의-가이드라인" aria-hidden="true" class="header-anchor">#</a> 함수 기반 뷰로 코드 작성할 때의 가이드라인</h3><ul><li>뷰 코드는 작을수록 좋다</li><li>뷰에서 절대 코드를 반복해서 사용하지 말자</li><li>뷰는 프레젠테이션 로직을 처리해야 한다. 비즈니스 로직은 가능한 한 모델 로직에 적용시키고 만약 해야 한다면 폼 안에 내재</li><li>뷰를 가능한 한 단순하게 유지</li><li>403, 404, 500을 처리하는 커스텀 코드를 쓰는 데 이용하라</li><li>복잡하게 중첩된 if 블록 구문을 피하자</li></ul><h3 id="httprequest객체-전달하기"><a href="#httprequest객체-전달하기" aria-hidden="true" class="header-anchor">#</a> HTTPRequest객체 전달하기</h3><p>미들웨어나 context processors같은 글로벌 액션에 연동되어 있지 않은 경우 재사용에 문제 생김.
프로젝트 전체를 아우르는 유틸리티 함수 만드는 것을 추천</p><div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># sprinkles/utils.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> PermissionDenied

<span class="token comment"># 사용자의 권한을 체크하고 없으면 HTTP 403을 사용자에게 반환</span>
<span class="token keyword">def</span> <span class="token function">check_sprinkle_rights</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>user<span class="token punctuation">.</span>can_sprinkle <span class="token operator">or</span> request<span class="token punctuation">.</span>user<span class="token punctuation">.</span>is_staff<span class="token punctuation">:</span>
        request<span class="token punctuation">.</span>can_sprinkle <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> request

    <span class="token keyword">raise</span> PermissionDenied

<span class="token comment"># sprinkles/views.py</span>
<span class="token keyword">def</span> <span class="token function">sprinkle_list</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    request <span class="token operator">=</span> check_sprinkles<span class="token punctuation">(</span>request<span class="token punctuation">)</span>

    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span>
        <span class="token string">&quot;sprinkles/sprinkle_list.html&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">&quot;sprinkles&quot;</span><span class="token punctuation">:</span> Sprinkle<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token punctuation">)</span>

<span class="token comment"># template</span>
<span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> request<span class="token punctuation">.</span>user<span class="token punctuation">.</span>can_sprinkle <span class="token operator">or</span> request<span class="token punctuation">.</span>user<span class="token punctuation">.</span>is_staff <span class="token punctuation">}</span> <span class="token comment"># 이거 대신</span>
<span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> request<span class="token punctuation">.</span>can_sprinkle <span class="token punctuation">}</span> <span class="token comment"># 요렇게 쓸 수 있다.</span>
</code></pre></div><h3 id="데코레이터"><a href="#데코레이터" aria-hidden="true" class="header-anchor">#</a> 데코레이터</h3><p>꼭 필요한 것이 아닌, 코드를 더 간결하게 해주는 것.</p><div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># sprinkles/decorators.py</span>
<span class="token keyword">from</span> functools <span class="token keyword">import</span> wraps

<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> utils

<span class="token keyword">def</span> <span class="token function">check_sprinkles</span><span class="token punctuation">(</span>view_func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    @wraps<span class="token punctuation">(</span>view_func<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">new_view_func</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        request <span class="token operator">=</span> util<span class="token punctuation">.</span>can_sprinkle<span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token comment"># request객체를 utils.can_sprinkle()에 넣는다</span>
        response <span class="token operator">=</span> view_func<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span> <span class="token comment"># 뷰 함수 호출</span>
        <span class="token keyword">return</span> response
    <span class="token keyword">return</span> new_view_func

<span class="token comment"># views.py</span>
<span class="token keyword">from</span> <span class="token punctuation">.</span>decorators <span class="token keyword">import</span> check_sprinkles

@check_sprinkles
<span class="token keyword">def</span> <span class="token function">sprinkle_detail</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sprinkle <span class="token operator">=</span> get_object_or_404<span class="token punctuation">(</span>Sprinkle<span class="token punctuation">,</span> pk<span class="token operator">=</span>pk<span class="token punctuation">)</span>

    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span>
        <span class="token string">&quot;sprinkles/sprinkle_detail.html&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">&quot;sprinkle&quot;</span><span class="token punctuation">:</span> sprinkle<span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
</code></pre></div><p>데코레이터 남용하지 않아야 한다.</p><hr><h2 id="_10-클래스-기반-뷰의-모범적-이용"><a href="#_10-클래스-기반-뷰의-모범적-이용" aria-hidden="true" class="header-anchor">#</a> 10. 클래스 기반 뷰의 모범적 이용</h2><p>함수 기반 뷰에서는 뷰 함수 자체가 내장 함수이고,
클래스 이반 뷰에서는 뷰 클래스가 내장 함수를 반환하는 as_view() 클래스 메서드를 제공한다.
django.views.generic.View에서 해당 메커니즘 구현. 모든 클래스 뷰는 이걸 상속받아서 이용.</p><h3 id="클래스-기반-뷰-이용할-때-가이드라인"><a href="#클래스-기반-뷰-이용할-때-가이드라인" aria-hidden="true" class="header-anchor">#</a> 클래스 기반 뷰 이용할 때 가이드라인</h3><ul><li>뷰 코드 양은 적을수록 좋다</li><li>뷰 안에서 DRY</li><li>뷰는 프레젠테이션 로직에서 관리. 비즈니스 로직은 모델에서. 매우 특별한 경우에는 폼에서 처리</li><li>뷰는 간단 명료해야 한다</li><li>403, 404, 500에러 핸들링에 CBV는 이용X. 대신 FBV이용.</li><li>믹스인은 간단 명료해야 한다.</li></ul><h3 id="cbv와-믹스인-이용하기"><a href="#cbv와-믹스인-이용하기" aria-hidden="true" class="header-anchor">#</a> CBV와 믹스인 이용하기</h3><p>믹스인: 실체화된 클래스가 아니라 상속해 줄 기능들을 제공하는 클래스 의미. (실체화(instatiation)되기 전 단계)</p><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">FreshFruitMixin</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get_context_data</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        context <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span>FreshFruitMixin<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>get_context_data<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        context<span class="token punctuation">[</span><span class="token string">&quot;has_fresh_fruit&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> context

<span class="token keyword">class</span> <span class="token class-name">FruityFlavorView</span><span class="token punctuation">(</span>FreshFruitMixin<span class="token punctuation">,</span> TemplateView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    template_name <span class="token operator">=</span> <span class="token string">&quot;fruity_flavor.html&quot;</span>
</code></pre></div><p><code>TemplateView</code>가 장고 제공하는 기본 클래스이기 때문에 가장 오른쪽.</p><ul><li>장고 제공 기본 뷰는 오른쪽에 놓는다</li><li>믹스인은 왼쪽에 놓는다</li><li>믹스인은 파이썬의 기본 객체 타입을 상속해야 한다</li></ul><h3 id="장고-cbv-종류"><a href="#장고-cbv-종류" aria-hidden="true" class="header-anchor">#</a> 장고 CBV 종류</h3><ul><li>View: 기본 뷰</li><li>RedirectView: 다른 URL로 리다이렉트</li><li>TemplateView: 장고 HTML 템플릿 보여줄 때</li><li>ListView: 객체 목록</li><li>DetailView: 객체 보여줌</li><li>FormView: 폼 전송</li><li>CreateView: 객체를 만들 때</li><li>UpdateView: 객체 업데이트</li><li>DeleteView: 객체 삭제</li><li>generic date view: 시간 순으로 객체 나열해 보여줄 때. 블로그에서 일반적으로 이용</li></ul><h3 id="인증된-사용자에게만-접근-가능하게-하기"><a href="#인증된-사용자에게만-접근-가능하게-하기" aria-hidden="true" class="header-anchor">#</a> 인증된 사용자에게만 접근 가능하게 하기</h3><p><code>django-braces</code>가 제공하는 <code>LoginRequiredMixin</code></p><div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># flavors/views.py</span>
<span class="token keyword">from</span> braces<span class="token punctuation">.</span>views <span class="token keyword">import</span> LoginRequiredMixin

<span class="token keyword">class</span> <span class="token class-name">FlavorDetailView</span><span class="token punctuation">(</span>LoginRequiredMixin<span class="token punctuation">,</span> DetailView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    솰라라라
</code></pre></div><p>질문: @login_required대신 이 믹스인을 쓰는 이유</p><h3 id="뷰에서-유효한-폼을-이용해-커스텀-액션-구현"><a href="#뷰에서-유효한-폼을-이용해-커스텀-액션-구현" aria-hidden="true" class="header-anchor">#</a> 뷰에서 유효한 폼을 이용해 커스텀 액션 구현</h3><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">FlavorCreateView</span><span class="token punctuation">(</span>LoginRequiredMixin<span class="token punctuation">,</span> CreateView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> Flavor
    fields <span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'slug'</span><span class="token punctuation">,</span> <span class="token string">'scoops_reaining'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">form_valid</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> form<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 이미 체크된 폼에 대해 커스텀 로직 적용. 원하는 일 한다</span>
        <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span>FlavorCreateView<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>form_valid<span class="token punctuation">(</span>form<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">form_invalid</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> form<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span>FlavorCreateView<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>form_invalid<span class="token punctuation">(</span>form<span class="token punctuation">)</span>
</code></pre></div><h3 id="뷰-객체-이용하기"><a href="#뷰-객체-이용하기" aria-hidden="true" class="header-anchor">#</a> 뷰 객체 이용하기</h3><p>자체적 메서드/속성 제공하는 뷰 객체로 다른 메서드/속성에서 호출이 가능하게 하는 방법 쓸 수 있다.
이 뷰 객체들은 템플릿에서도 호출 가능</p><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> <span class="token punctuation">.</span>tasks <span class="token keyword">import</span> update_users_who_favorited

<span class="token keyword">class</span> <span class="token class-name">FavoriteMixin</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    @cached_property
    <span class="token keyword">def</span> <span class="token function">likes_and_favorites</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        likes <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token builtin">object</span><span class="token punctuation">.</span>likes<span class="token punctuation">(</span><span class="token punctuation">)</span>
        favorites <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token builtin">object</span><span class="token punctuation">.</span>favorites<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;likes&quot;</span><span class="token punctuation">:</span> likes<span class="token punctuation">,</span>
            <span class="token string">&quot;favorites&quot;</span><span class="token punctuation">:</span> favorites<span class="token punctuation">,</span>
            <span class="token string">&quot;favorites_count&quot;</span><span class="token punctuation">:</span> favorites<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token comment"># likes와 favorites의 딕셔너리를 반환</span>


<span class="token keyword">class</span> <span class="token class-name">FlavorUpdateView</span><span class="token punctuation">(</span>LooginRequireMixin<span class="token punctuation">,</span> FavoriteMixin<span class="token punctuation">,</span> UpdateView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> Flavor
    fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'slug'</span><span class="token punctuation">,</span> <span class="token string">'scoops_remaining'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">form_valid</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> form<span class="token punctuation">)</span><span class="token punctuation">:</span>
        update_users_who_favorited<span class="token punctuation">(</span>
            instance<span class="token operator">=</span>self<span class="token punctuation">.</span><span class="token builtin">object</span><span class="token punctuation">,</span>
            favorites<span class="token operator">=</span>self<span class="token punctuation">.</span>likes_and_favorites<span class="token punctuation">[</span><span class="token string">'favorites'</span><span class="token punctuation">]</span>
            <span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token string">'FlavorCreateView'</span><span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>form_valid<span class="token punctuation">(</span>form<span class="token punctuation">)</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>&lt;li&gt;likes: {{view.likes_and_favorites.likes}}&lt;/li&gt;
&lt;li&gt;Favorites: {{view.likes_and_favorites.favorites_count}}&lt;/li&gt;
</code></pre></div><p>질문: 어떻게 쓰는지 헷갈린다. context넘기는거랑 어떻게 다른지</p><h3 id="제네릭-클래스-기반-뷰와-폼-사용하기"><a href="#제네릭-클래스-기반-뷰와-폼-사용하기" aria-hidden="true" class="header-anchor">#</a> 제네릭 클래스 기반 뷰와 폼 사용하기</h3><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> messages

<span class="token keyword">class</span> <span class="token class-name">FlavorActionMixin</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'slug'</span><span class="token punctuation">,</span> <span class="token string">'scoops_remaining'</span><span class="token punctuation">)</span>

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">success_msg</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> NotImplemented

    <span class="token keyword">def</span> <span class="token function">form_valid</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> form<span class="token punctuation">)</span><span class="token punctuation">;</span>
        messages<span class="token punctuation">.</span>info<span class="token punctuation">(</span>self<span class="token punctuation">.</span>request<span class="token punctuation">,</span> self<span class="token punctuation">.</span>success_msg<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span>FlavorActionMixin<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>form_valid<span class="token punctuation">(</span>form<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">FlavorCreateView</span><span class="token punctuation">(</span>LoginRequiredMixin<span class="token punctuation">,</span> FlavorActionMixin<span class="token punctuation">,</span> CreateView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> Flavor
    success_msg <span class="token operator">=</span> <span class="token string">&quot;Flavor 만들어짐&quot;</span>

<span class="token keyword">class</span> <span class="token class-name">FlavorUpdateView</span><span class="token punctuation">(</span>LoginRequiredMixin<span class="token punctuation">,</span> FlavorActionMixin<span class="token punctuation">,</span> UpdateView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> Flavor
    success_msg <span class="token operator">=</span> <span class="token string">&quot;Flavor 업데이트됨&quot;</span>

<span class="token keyword">class</span> <span class="token class-name">FlavorDetailView</span><span class="token punctuation">(</span>DetailView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> Flavor
</code></pre></div><hr><h2 id="_11-장고-폼의-기초"><a href="#_11-장고-폼의-기초" aria-hidden="true" class="header-anchor">#</a> 11. 장고 폼의 기초</h2><p>장고 폼에 대해 기억해야 할 가장 중요한 점은 어떠한 데이터든 간에 입력 데이터라고 한다면 장고 폼을 이용하여 유효성 검사를 해야 한다는 것이다.</p><h3 id="장고-폼으로-모든-입력-데이터-유효성-검사"><a href="#장고-폼으로-모든-입력-데이터-유효성-검사" aria-hidden="true" class="header-anchor">#</a> 장고 폼으로 모든 입력 데이터 유효성 검사</h3><p>장고 폼은 파이썬 딕셔너리 유효성 검사시 최상 도구.
다른 프로젝트로부터 CSV파일 받아 모델에 업데이트하는 장고 앱</p><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">add_csv_purchases</span><span class="token punctuation">(</span>rows<span class="token punctuation">)</span><span class="token punctuation">:</span>
    rows <span class="token operator">=</span> StringIO<span class="token punctuation">.</span>StringIO<span class="token punctuation">(</span>rows<span class="token punctuation">)</span>
    records_added <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">for</span> row <span class="token keyword">in</span> csv<span class="token punctuation">.</span>DictReader<span class="token punctuation">(</span>rows<span class="token punctuation">,</span> delimiter<span class="token operator">=</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 절대 따라하지 말것. 유효성 검사 없이 바로 모델로 데이터 입력</span>
        purchase<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token operator">**</span>row<span class="token punctuation">)</span>
        records_added <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">return</span> records_added
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">PurchaseForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>ModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Purchase

    <span class="token keyword">def</span> <span class="token function">clean_seller</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        seller <span class="token operator">=</span> self<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">[</span><span class="token string">'seller'</span><span class="token punctuation">]</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            Seller<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>name<span class="token operator">=</span>seller<span class="token punctuation">)</span>
        <span class="token keyword">except</span> Seller<span class="token punctuation">.</span>DoesNotExist<span class="token punctuation">:</span>
            msg <span class="token operator">=</span> <span class="token string">&quot;{0}은 purchase #{1}에 없습니다&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
                seller<span class="token punctuation">,</span>
                self<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">[</span><span class="token string">'purchase_number'</span><span class="token punctuation">]</span>
                <span class="token punctuation">)</span>
            <span class="token keyword">raise</span> forms<span class="token punctuation">.</span>ValidationError<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
        <span class="token keyword">return</span> seller
</code></pre></div><h3 id="장고의-폼-인스턴스-속성-추가하기"><a href="#장고의-폼-인스턴스-속성-추가하기" aria-hidden="true" class="header-anchor">#</a> 장고의 폼 인스턴스 속성 추가하기</h3><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">TasterUpdateView</span><span class="token punctuation">(</span>UpdateView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> Taster
    form_class <span class="token operator">=</span> TasterForm

    <span class="token keyword">def</span> <span class="token function">get_form_kwargs</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 키워드 인자로 폼 추가하기</span>
        kwargs <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span>TasterUpdateView<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>get_form_kwargs<span class="token punctuation">(</span><span class="token punctuation">)</span>
        kwargs<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>user
        <span class="token keyword">return</span> kwargs
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">TasterForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>ModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Taster

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>user kwargs<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>TasterForm<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
</code></pre></div><p>이렇게 주입하는거 꽤 빈번하게 이루어짐.</p><h3 id="폼이-유효성을-검사하는-방법"><a href="#폼이-유효성을-검사하는-방법" aria-hidden="true" class="header-anchor">#</a> 폼이 유효성을 검사하는 방법</h3><ul><li>순서
<ul><li>폼이 데이터 받음 -&gt; <code>form.is_valid()</code>가 <code>form.full_clean()</code>메서드 호출</li><li></li></ul></li></ul><hr><h2 id="_16-rest-api-구현하기"><a href="#_16-rest-api-구현하기" aria-hidden="true" class="header-anchor">#</a> 16. REST API 구현하기</h2><p>REST API: 다양한 환경과 용도에 맞는 데이터를 제공하는 디자인을 정의</p><ul><li>django-rest-framework: 장고 기본 CBV를 바탕으로 브라우징 가능한 편리한 API 등을 제공. 가장 많이 쓰임</li><li>django-tastypie</li><li>django-braces(클래스 기반 뷰), django-jsonview(함수 기반 뷰): 단순하고 빠름</li></ul><p>(질문) GET, POST말고 써본적 있나</p><ul><li>용도
<ul><li>읽기전용만: GET만 구현해도 됨</li><li>읽기/쓰기: POST도 구현. PUT과 DELETE도 고려</li><li>단순화하기 위해 때떄로 GET, POST만으로도 구현</li><li>GET, PUT, DELETE는 여러 번 실행해도 그 결과가 변하지 않는 멱등(item-potent)관계이며 POST와 PATCH는 그러지 않다 (&lt;-질문)</li></ul></li><li>HTTP 상태 코드
<ul><li>200 OK: [GET]리소스 반환, [PUT]상태 메시지 제공/리소스 반환</li><li>201 Created: [POST]상태 메세지/새로 생성 리소스 반환</li><li>204 No Content: [DELETE] 성공적으로 삭제된 요청의 응답</li><li>304 Unchanged: (Redirect). 이전 요청으로부터 아무런 변화 없음.</li><li>400 Bad Request: 에러 메세지 반환</li><li>401 Unauthorized: 인증 요청 했으나 사용자가 인증 요건 제공 ㄴㄴ</li><li>403 Forbidden: 사용자가 허용되지 않은 콘텐츠로 접근 시도</li><li>404 Not Found: 리소스 없음</li><li>405 Method Not Allowed: 허가되지 않은 HTTP 메서드로 시도</li><li>410 Gone: 더는 제공되지 않는 메서드로 호출. 새버전 API제공 위해 기존 API서비스 중지할 떄 이용. 모바일 앱에서 해당 결과에 대해 사용자에게 애플리케이션 업그레이드 요청하는 방법 쓰기도 한다.</li><li>429 Too many requests: 제한 시간 내에 너무 많은 요청을 보냄. 접속 제한을 이용할 때 쓰인다.</li></ul></li></ul><h3 id="간단한-json-api-구현하기"><a href="#간단한-json-api-구현하기" aria-hidden="true" class="header-anchor">#</a> 간단한 JSON API 구현하기</h3><p>질문: Serializer가 모냐</p><h3 id="rest-api-아키텍쳐"><a href="#rest-api-아키텍쳐" aria-hidden="true" class="header-anchor">#</a> REST API 아키텍쳐</h3><ul><li>프로젝트 코드들은 간결히 정리되어있어야 한다
<ul><li>API만 전담해서 처리하는 앱을 따로 구성하는게 적절하기도 함.</li><li>이 앱의 이름에 해당 API버전을 포함시켜야 한다. e.g. apiv4</li><li>단점: 해당 API앱이 너무 커지거나 각 api를 지원하는 개별 앱으로부터 해당 API앱이 단절될 수도 있다는 점.</li></ul></li><li>앱의 코드는 앱 안에 두자
<ul><li>REST API는 단순한 뷰의 모음.</li><li>단점: 작게 나뉜 상호 연관되는 앱이 너무 많이 존재.</li></ul></li><li>비지니스 로직을 API뷰에서 분리
<ul><li>모델 메서드, 매니저 메서드 등에 분리</li></ul></li><li>API Url을 모아두기
<ul><li>루트 urls.py에 <code>url(r&quot;^api/&quot;, include(&quot;core.api&quot;, namespace=&quot;api&quot;)),</code>으로 추가.</li></ul></li><li>API 테스트하기</li><li>API 버저닝하기
<ul><li>API의 URL에 버전 정보를 나타내는 것은 매우 유용하다. e.g. /api/v1/users</li></ul></li></ul><h3 id="서비스-지향-아키텍처"><a href="#서비스-지향-아키텍처" aria-hidden="true" class="header-anchor">#</a> 서비스 지향 아키텍처</h3><p>SOA관점에서 웹 애플리케이션은 독립적이고 분리된 컴포넌트로 구성된다.
각 컴포넌트는 독립된 서버 혹은 클러스터에서 구동. 이러한 컴포넌트 사이 커뮤니케이션에 REST API사용.</p><h3 id="외부-api-중단하기"><a href="#외부-api-중단하기" aria-hidden="true" class="header-anchor">#</a> 외부 API 중단하기</h3><ul><li>사용자들에게 예고</li><li>401 에러 뷰로 API 교체
<ul><li>새 API 엔드포인트 링크</li><li>새 API 문서의 링크</li><li>서비스 중지에 대한 세부 사항을 알려주는 문서로의 링크</li></ul></li></ul><h3 id="rest-프레임워크들에-대한-평가"><a href="#rest-프레임워크들에-대한-평가" aria-hidden="true" class="header-anchor">#</a> REST 프레임워크들에 대한 평가</h3><ul><li>django-rest-framework가 현실적인 표준으로 자리 잡고 있다</li><li>보일러플레이트를 얼마나 쓸 것인가? (요즘은 최소화하는 방향으로 변하고 있음)</li><li>RPC구현이 쉬운가? 특정 메서드를 클라이언트 측에 RESTful API로 제공. e.g. <code>icecream.pour_syrup(syrup)</code></li></ul><h3 id="api에-접속-제한하기"><a href="#api에-접속-제한하기" aria-hidden="true" class="header-anchor">#</a> API에 접속 제한하기</h3><ul><li>제한 없는 API 접속은 위험하다</li></ul><hr><h2 id="_17-rest-api-이용하기"><a href="#_17-rest-api-이용하기" aria-hidden="true" class="header-anchor">#</a> 17. REST API 이용하기</h2><ul><li>검색 엔진이 컨텐츠를 인덱스 할 수 있게 만들기
<ul><li>Ajax 기반 콘텐츠를 검색 가능하도록 하게</li><li>직접 sitemap.xml 제작하기</li><li>유료로 제공되는 brombone.com</li></ul></li><li>실시간 서비스가 왜 어려운가(지연 Latency 문제)
<ul><li>애니메이션을 이용해 지연 숨기기</li><li>전송 성공을 위조하기 (?)</li><li>지리적 위치에 기반을 둔 서버들</li><li>지역적으로 이용자 제한하기</li></ul></li><li>안티 패턴 피하기
<ul><li>여러 페이지로 구성된 앱이 필요한 경우인데도 단일 페이지 앱으로만 구성
<ul><li>기존의 전통적인 CMS사이트까지 이러한 구성을 정말 필요로 할까?</li></ul></li><li>테스트를 하지 않는 경우</li><li>자바스크립트의 메모리 관리를 이해하지 않는 실수
<ul><li>브라우저간의 객체들이 긴 시간동안 존재하다가 느려지고 충돌될 수 있음</li></ul></li><li>jQuery가 아닐 때 DOM에 데이터 저장</li></ul></li><li>AJAX와 CSRF 토큰
<ul><li>jQuery: csrf.js를 생성해서 템플릿에 추가해줌</li><li>Angular: HTTP 헤더에 토큰 넣기</li></ul></li></ul><p>(아직 정리 안함)</p><hr><h2 id="_18-장고-코어-모듈을-교체할-때-주의점"><a href="#_18-장고-코어-모듈을-교체할-때-주의점" aria-hidden="true" class="header-anchor">#</a> 18. 장고 코어 모듈을 교체할 때 주의점</h2><p>장고 스택 코어 부분 굳이 교체할 필요 없음.</p><hr><h2 id="_19-장고-어드민-이용하기"><a href="#_19-장고-어드민-이용하기" aria-hidden="true" class="header-anchor">#</a> 19. 장고 어드민 이용하기</h2><ul><li>어드민 기능은 최종 사용자를 위한 것이 아니다</li><li>모든 장고 모델에 대해 항상 <code>__str__()</code>메서드를 구현하자.</li><li>다중 사용자가 이용하는 환경에서 list_editable이용은 피하자 (수정이 겹칠 수 있음)</li></ul><hr><h2 id="_21-장고의-비법-소스-서드-파티-패키지들"><a href="#_21-장고의-비법-소스-서드-파티-패키지들" aria-hidden="true" class="header-anchor">#</a> 21. 장고의 비법 소스: 서드 파티 패키지들</h2><ul><li>항상 패키지 의존성에 세부 버전 번호 표시하기</li><li>제작되는 패키지는 반드시 테스트를 거쳐야 한다</li><li>다른 패키지들의 라이브러리 호환성을 위해 가능한 한 넓게 기술(e.g. <code>Django==1.7.2</code>보다는 <code>Django==1.8</code>이나 <code>Django&gt;-1.5,&lt;1.9</code>)</li><li>완성된 패키지에는 라이선스가 필요하다(MIT 추천). LICENSE.rst파일 제작</li><li>url namespace만들기</li><li>휠을 생성하고 파이썬 패키지 인덱스로 배포하기 &lt;- 뭐지</li><li>기본 예제 템플릿을 제공하라</li></ul><hr><h2 id="_22-테스트-정말-거추장스럽고-낭비일까"><a href="#_22-테스트-정말-거추장스럽고-낭비일까" aria-hidden="true" class="header-anchor">#</a> 22. 테스트, 정말 거추장스럽고 낭비일까?</h2><h3 id="question"><a href="#question" aria-hidden="true" class="header-anchor">#</a> Question</h3><ul><li>263: 요청 인스턴스가 뭐지</li><li>265: 픽스쳐가 뭐지</li></ul><hr><h2 id="_24-장고-성능-향상시키기"><a href="#_24-장고-성능-향상시키기" aria-hidden="true" class="header-anchor">#</a> 24. 장고 성능 향상시키기</h2><ul><li>django-debug-toolbar로 문제되는 쿼리 찾아내기
<ul><li>중복된 쿼리, 예상보다 많은 양의 쿼리를 호출하는 ORM, 느린 쿼리</li><li>django-cache-panel도 추가</li></ul></li><li>쿼리 수 줄이기
<ul><li><code>select_related()</code> 이용하기</li><li>manytomany나 manytoone에서는 <code>prefetch_related()</code> 사용하기</li><li>템플릿 하나당 하나 이상의 같은 쿼리가 호출된다면 해당 쿼리를 파이썬 뷰로 이동시켜 context를 변수로 처리하고 이 콘텍스트 변수에서 템플릿 ORM 호출</li><li>키-값 형식을 이용할 수 있는 캐시 구현하거나 memcached등을 이용해보라.</li></ul></li><li>일반 쿼리 빠르게 하기
<ul><li>일반적으로 느린 쿼리들의 대부분을 인덱스로 최적화할 수 있다.</li></ul></li><li>ATOMIC_REQUESTS 비활성하기
<ul><li>이게 뭐지</li></ul></li><li>데이터베이스에서 삼가야 할 것들
<ul><li>DB에 로그 데이터를 저장하지 말아라</li><li>일시적 데이터를 DB에 저장하지 마라</li></ul></li><li>HTML, JS, CSS 압축과 최소화</li><li>업스트림 캐시나 CDN 이용</li></ul><hr><h2 id="_26-장고-보안의-실전-방법론"><a href="#_26-장고-보안의-실전-방법론" aria-hidden="true" class="header-anchor">#</a> 26. 장고 보안의 실전 방법론</h2><ul><li>장고 1.8의 보안 기능
<ul><li>XSS(cross-site scripting)</li><li>CSRF(cross-site request forgery)</li><li>SQL 인젝션</li><li>Clickjacking</li><li>secure cookie를 포함한 TLS, HTTPS. HSTS지원</li><li>기본 설정으로 SHA256과 PBKDF2알고리즘을 이용한 안전 패스워드 저장</li><li>자동 HTML 이스케이핑</li><li>expat파서를 통한 xml폭탄 공격 대비</li><li>강력해진 JSON, YAML, XML직렬화/역직렬화 도구</li></ul></li><li>상용 환경에서 debug모드 끄기
<ul><li>allowed_host도 반드시 설정</li></ul></li><li>보안 키 안전하게 보관하기</li><li>HTTPS이용하기
<ul><li>사이트의 모든 부분(정적 리소스까지) 모두 https를 통해 서비스되어야 함</li><li>방문자들이 http로 접속했다면 https로 리다이렉트되어야 한다</li></ul></li><li>안전한 쿠키 이용하기
<ul><li>어떤 경우에도 https가 아니면 브라우저가 쿠키를 전송하지 못하도록 해야 함</li></ul></li><li>HSTS 이용하기</li><li>https설정 도구</li><li>ALLOWED_HOSTS설정 이용하기</li><li>데이터를 수정해야 하는 http 폼에 대해서는 항상 csrf 보안을 이용하자</li><li>XSS공격으로부터 사이트 방어하기(html 이스케이프)
<ul><li>mark_safe보다는 장고 템플릿을 이용하자</li><li>js에서 이용되는 데이터엔 항상 JSON 인코딩 이용</li></ul></li></ul><hr><h2 id="_27-로깅-누구를-위한-것인가"><a href="#_27-로깅-누구를-위한-것인가" aria-hidden="true" class="header-anchor">#</a> 27. 로깅 - 누구를 위한 것인가</h2><ul><li>로깅의 종류
<ul><li>애플리케이션 로그</li><li>서버 로그</li><li>데이터베이스 로그</li><li>네트워크 로그</li></ul></li><li>로깅 왜 하느냐
<ul><li>스택 트레이스나 디버깅 도구로는 충분하지 못할 때</li></ul></li><li>로그 레벨
<ul><li>Critical
<ul><li>심각한 참사 일어날거같아 급하게 주의</li><li>e.g. 내부적으로 구동하는 웹서비스에 의존하고 있었는데 그게 접근 불가</li><li>코어 장고 코드에는 쓰이지 않는다</li></ul></li><li>Error
<ul><li>상용 환경의 에러</li><li>e.g. store.pinkfong.com 에서 특정 페이지가 404뜨고 있을 때 centry로 메일 날아옴</li></ul></li><li>Warning
<ul><li>중요도가 낮은 문제</li><li>e.g. 가짜 어드민 폼으로 django-admin-honeypot이용시 사용자가 여기 들어왔을때</li></ul></li><li>Info
<ul><li>유용한 상태 정보, 중요한 이벤트에 대한 응답으로 일어난 상태의 변화</li></ul></li></ul></li><li>응답 메서드는 이메일, 로그 파일, 콘솔, stdout형태로 이용될 수 있다. 센트리와  같은 애플리케이션으로 HTTP 요청 푸시를 발생시킬 수도 있다.</li><li>예외 처리할때 해당 예외에 대해 스택 트레이스 정보를 로그로 남기는것도 도움됨
<ul><li>Logger.exception()은 ERROR레벨에서 자동으로 트레이스백과 로그를 포함한다</li><li>다른 로그 레벨에 대해서는 exec_info옵션 키워드를 이용하라</li></ul></li><li>한 모듈당 한 개의 로거 쓰기</li></ul><hr><h2 id="_28-시그널-이용-사례와-시그널을-피할-수-있는-기술들"><a href="#_28-시그널-이용-사례와-시그널을-피할-수-있는-기술들" aria-hidden="true" class="header-anchor">#</a> 28. 시그널: 이용 사례와 시그널을 피할 수 있는 기술들</h2><ul><li>시그널은 최후의 수단이다</li><li>시그널 이용
<ul><li><p>DONT</p><ul><li>시그널이 하나의 특별한 모델에 연관되어 있으며 모델 메서드 중 하나로 이전 가능할떄. save()로 호출 가능한 경우</li><li>커스텀 모델 매니저 메서드를 시그널 대신 이용할 수 있을 때</li><li>특정 뷰에 연관된 시그널이 해당 뷰 안으로 이동될 수 있을 떄</li></ul></li><li><p>DO</p></li><li><p>음 사실 뭔소린지 잘 모르겠다</p></li></ul></li></ul><hr><h2 id="_29-유틸리티들에-대해"><a href="#_29-유틸리티들에-대해" aria-hidden="true" class="header-anchor">#</a> 29. 유틸리티들에 대해</h2><ul><li>core 앱 만들기
<ul><li>비추상화(non-abstract)모델 <code>&lt;-차라리 abstract모델이 있어야 하는거 아닌가</code></li><li>어드민 자동 발견(admin auto-discovery) 적용</li><li>템플릿 태그와 필터 위치</li></ul></li><li>utils.py
<ul><li>여러 곳에서 공통으로 쓰이는 코드 저장</li><li>모델을 좀 더 간결하게 만들기 (utils.py, helpers.py)</li></ul></li><li>장고 내장 utils.py
<ul><li>django.contrib.humanize
<ul><li>intcomma, 텍스트 프로세싱</li></ul></li><li>django.utils.decorators.method_decorator(decorator)
<ul><li>함수 데코레이터</li><li>?</li></ul></li><li>django.utils.decorators.decorator_from_middleware(middleware)</li><li>django.utils.encoding.force_text(value)
<ul><li>장고의 무엇이든지 파이선3의 일반 str형태, 또는 파이썬2의 unicode형태로 변환</li></ul></li></ul></li></ul><hr><h2 id="_30-배포-paas"><a href="#_30-배포-paas" aria-hidden="true" class="header-anchor">#</a> 30. 배포: PaaS</h2><ul><li>Platform as a Service
<ul><li>절대 PaaS에 종속되지 않도록 하자. 호스팅 제공사에 따라 구조 변경이 생길 수 있는 아키텍쳐를 최대한 피하는데 좀 더 관심 두기</li></ul></li><li>종류
<ul><li>heroku</li><li>pythonanywhere</li></ul></li></ul></div><div class="page-edit"><!----><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/TIL/Django/react-with-django-rest-framework.html" class="prev">
          [서버부터 프론트까지] React와 Django로 웹 서비스 뚝딱 세팅하기 (feat. Webpack, Redux, django rest framework, PWA)
        </a></span><span class="next"><a href="/TIL/ETC/2015-NEXT-BALBUM.html">
          서버 시작하기
        </a> →
      </span></p></div></div></div></div>
    <script src="/TIL/assets/js/156.3e99d878.js" defer></script><script src="/TIL/assets/js/app.4577e9c5.js" defer></script>
  </body>
</html>
